(ns ipmi-aleph.test-payloads
  (:require [ipmi-aleph.codec :refer [rmcp-decode]]))

(def rmcp-payloads
  {:rmcp-ack                 [0x06 0x00 0xff 0x86]
   :rmcp-ping                [0x06 0x00 0xff 0x06 0x00 0x00 0x11 0xbe 0x80 0xc4 0x00 0x00]
   :rmcp-pong                [0x06 0x00 0xff 0x06 0x00 0x00 0x11 0xbe 0x40 0xc4 0x00 0x10
                              0x00 0x00 0x11 0xbe 0x00 0x00 0x00 0x00 0x81 0x00 0x00 0x00
                              0x00 0x00 0x00 0x00]
   :get-channel-auth-cap-req [0x06 0x00 0xff 0x07 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
                              0x00 0x09 0x20 0x18 0xc8 0x81 0x00 0x38 0x8e 0x04 0xb5]
   :get-channel-auth-cap-rsp [0x06 0x00 0xff 0x07 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
                              0x00 0x10 0x81 0x1c 0x63 0x20 0x00 0x38 0x00 0x01 0x97 0x04
                              0x03 0x00 0x00 0x00 0x00 0x09]
   :open-session-request     [0x06 0x00 0xff 0x07 0x06 0x10 0x00 0x00 0x00 0x00 0x00 0x00
                              0x00 0x00 0x20 0x00 0x00 0x00 0x00 0x00 0xa4 0xa3 0xa2 0xa0
                              0x00 0x00 0x00 0x08 0x01 0x00 0x00 0x00 0x01 0x00 0x00 0x08
                              0x01 0x00 0x00 0x00 0x02 0x00 0x00 0x08 0x01 0x00 0x00 0x00]
   :open-session-response    [0x06 0x00 0xff 0x07 0x06 0x11 0x00 0x00 0x00 0x00 0x00 0x00
                              0x00 0x00 0x24 0x00 0x00 0x00 0x00 0x00 0xa4 0xa3 0xa2 0xa0
                              0x82 0x04 0x00 0x00 0x00 0x00 0x00 0x08 0x01 0x00 0x00 0x00
                              0x01 0x00 0x00 0x08 0x01 0x00 0x00 0x00 0x02 0x00 0x00 0x08
                              0x01 0x00 0x00 0x00]
   :open-session-response-2  [0x06 0x00 0xff 0x07 0x06 0x11 0x00 0x00 0x00 0x00 0x00 0x00
                              0x00 0x00 0x24 0x00 0x00 0x00 0x04 0x00 0xa4 0xa3 0xa2 0xa0
                              0x00 0x0f 0x00 0x02 0x00 0x00 0x00 0x08 0x01 0x00 0x00 0x00
                              0x01 0x00 0x00 0x08 0x00 0x00 0x00 0x00 0x02 0x00 0x00 0x08
                              0x00 0x00 0x00 0x00]
   :rmcp-rakp-1              [0x06 0x00 0xff 0x07 0x06 0x12 0x00 0x00 0x00 0x00 0x00 0x00
                              0x00 0x00 0x21 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
                              0xcf 0x65 0x24 0x99 0xe6 0xba 0x89 0x44 0x4f 0x8f 0xe9 0x65
                              0x4a 0xd6 0xbc 0x4c 0x14 0x00 0x00 0x05 0x61 0x64 0x6d 0x69
                              0x6e]
   :rmcp-rakp-2              [0x06 0x00 0xff 0x07 0x06 0x13 0x00 0x00 0x00 0x00 0x00 0x00
                              0x00 0x00 0x28 0x00 0x00 0x00 0x00 0x00 0xa4 0xa3 0xa2 0xa0
                              0x2c 0x88 0x53 0xae 0xb8 0x3e 0xdd 0xa9 0x08 0xd5 0xab 0x70
                              0x87 0x92 0x77 0x65 0xa1 0x23 0x45 0x67 0x89 0xab 0xcd 0xef
                              0xa1 0x23 0x45 0x67 0x89 0xab 0xcd 0xef]
   :rmcp-rakp-3              [0x06 0x00 0xff 0x07 0x06 0x14 0x00 0x00 0x00 0x00 0x00 0x00
                              0x00 0x00 0x08 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00]
   :rmcp-rakp-4              [0x06 0x00 0xff 0x07 0x06 0x15 0x00 0x00 0x00 0x00 0x00 0x00
                              0x00 0x00 0x08 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00]
   :rmcp-close-session-req   [0x06 0x00 0xff 0x07 0x06 0x00 0x82 0x03 0x00 0x00 0x09 0x00
                              0x00 0x00 0x0b 0x00 0x20 0x18 0xc8 0x81 0x1c 0x3c 0x82 0x03
                              0x00 0x00 0xa2]
   :rmcp-close-session-rsp   [0x06 0x00 0xff 0x07 0x06 0x00 0xa4 0xa3 0xa2 0xa0 0x07 0x00
                              0x00 0x00 0x08 0x00 0x81 0x1c 0x63 0x20 0x1c 0x3c 0x00 0x88]
   :set-sess-prv-level-rsp   [0x06 0x00 0xff 0x07 0x06 0x00 0xa4 0xa3 0xa2 0xa0 0x01 0x00
                              0x00 0x00 0x09 0x00 0x81 0x1c 0x63 0x20 0x04 0x3b 0x00 0x04
                              0x9d]
   :set-sess-prv-level-req   [0x06 0x00 0xff 0x07 0x06 0x00 0x82 0x03 0x00 0x00 0x03 0x00
                              0x00 0x00 0x08 0x00 0x20 0x18 0xc8 0x81 0x04 0x3b 0x04 0x3c]
   :chassis-reset-req        [0x06 0x00 0xff 0x07 0x06 0x00 0x00 0x00 0x00 0x00 0x15 0x00
                              0x00 0x00 0x08 0x00 0x20 0x00 0xe0 0x81 0x18 0x02 0x03 0x62]
   :chassis-reset-rsp        [0x06 0x00 0xff 0x07 0x06 0x00 0xa4 0xa3 0xa2 0xa0 0x06 0x00
                              0x00 0x00 0x08 0x00 0x81 0x04 0x7b 0x20 0x18 0x02 0x00 0xc6]
   :chassis-status-req        [0x06 0x00 0xff 0x07 0x06 0x00 0x00 0x00 0x00 0x00 0x15 0x00
                               0x00 0x00 0x08 0x00 0x20 0x00 0xe0 0x81 0x18 0x01 0x66]
   :chassis-status-rsp        [0x06 0x00 0xff 0x07 0x06 0x00 0xa4 0xa3 0xa2 0xa0 0x06 0x00
                               0x00 0x00 0x0b 0x00 0x81 0x04 0x7b 0x20 0x18 0x01 0x00 0x01
                               0x00 0x00 0xc6]
   :device-id-req            [0x06 0x00 0xff 0x07 0x06 0x00 0x82 0x03 0x00 0x00 0x05 0x00 0x00
                              0x00 0x07 0x00 0x20 0x18 0xc8 0x81 0x0c 0x01 0x72]
   :device-id-rsp            [0x06 0x00 0xff 0x07 0x06 0x00 0xa4 0xa3 0xa2 0xa0 0x03 0x00 0x00
                              0x00 0x17 0x00 0x81 0x1c 0x63 0x20 0x0c 0x01 0x00 0x00 0x03 0x09
                              0x08 0x02 0x9f 0x91 0x12 0x00 0x02 0x0f 0x00 0x00 0x00 0x00 0x6a]})



(defn dump-functions [m]
    (letfn [(get-command [m] (get-in m [:rmcp-class :ipmi-session-payload :ipmi-2-0-payload :command]))
            (get-function [m] (get-in m [:rmcp-class :ipmi-session-payload :ipmi-2-0-payload :network-function :function]))
            (get-type [m] (get-in m [:rmcp-class :ipmi-session-payload :ipmi-2-0-payload :payload-type :type]))]
      (let [keys (vec (keys m))
            result (for [k keys
                               :let [decode (rmcp-decode (byte-array (k rmcp-payloads)))]
                               :when (contains? (get-in decode [:rmcp-class :ipmi-session-payload]) :ipmi-2-0-payload)]
                        {:key k :type (get-type decode) :command (get-command decode) :function (get-function decode)})
            ]
        (vec result))))



;; |                    :key | :type | :command | :function |
;; |-------------------------+-------+----------+-----------|
;; | :set-sess-prv-level-rsp |     0 |       59 |         7 |
;; |          :device-id-req |     0 |        1 |         6 |
;; |     :chassis-status-rsp |     0 |        1 |         1 |
;; |   :open-session-request |    16 |          |           |
;; | :rmcp-close-session-rsp |     0 |       60 |         7 |
;; |          :device-id-rsp |     0 |        1 |         7 |
;; |            :rmcp-rakp-4 |    21 |          |           |
;; | :rmcp-close-session-req |     0 |       60 |         6 |
;; |     :chassis-status-req |     0 |        1 |         0 |
;; |            :rmcp-rakp-3 |    20 |          |           |
;; |            :rmcp-rakp-2 |    19 |          |           |
;; | :set-sess-prv-level-req |     0 |       59 |         6 |
;; |  :open-session-response |    17 |          |           |
;; |            :rmcp-rakp-1 |    18 |          |           |
;; |      :chassis-reset-req |     0 |        2 |         0 |
;; |      :chassis-reset-rsp |     0 |        2 |         1 |
